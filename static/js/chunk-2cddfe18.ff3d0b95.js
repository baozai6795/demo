(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2cddfe18"],{"7e27":function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container"},[a("el-form",{directives:[{name:"show",rawName:"v-show",value:e.showSearch,expression:"showSearch"}],ref:"queryForm",attrs:{model:e.queryParams,size:"small",inline:!0}},[a("el-form-item",{attrs:{label:"项目编码",prop:"code"}},[a("el-input",{attrs:{placeholder:"请输入项目编码",clearable:""},model:{value:e.queryParams.code,callback:function(t){e.$set(e.queryParams,"code",t)},expression:"queryParams.code"}})],1),a("el-form-item",{attrs:{label:"项目名称",prop:"name"}},[a("el-input",{attrs:{placeholder:"请输入项目名称",clearable:""},model:{value:e.queryParams.name,callback:function(t){e.$set(e.queryParams,"name",t)},expression:"queryParams.name"}})],1),a("el-form-item",{attrs:{label:"服务类别",prop:"category"}},[a("el-cascader",{attrs:{options:e.categoryOptions,props:{emitPath:!1},"show-all-levels":!1,clearable:""},model:{value:e.queryParams.category,callback:function(t){e.$set(e.queryParams,"category",t)},expression:"queryParams.category"}})],1),a("el-form-item",{attrs:{label:"状态",prop:"status"}},[a("el-select",{attrs:{placeholder:"菜单状态",clearable:""},model:{value:e.queryParams.status,callback:function(t){e.$set(e.queryParams,"status",t)},expression:"queryParams.status"}},e._l(e.dict.type.project_status,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value,clearable:""}})})),1)],1),a("el-form-item",{attrs:{label:"发起人",prop:"createBy"}},[a("el-input",{attrs:{placeholder:"请输入发起人",clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleQuery(t)}},model:{value:e.queryParams.createBy,callback:function(t){e.$set(e.queryParams,"createBy",t)},expression:"queryParams.createBy"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary",icon:"el-icon-search",size:"mini"},on:{click:e.handleQuery}},[e._v("搜索")]),a("el-button",{attrs:{icon:"el-icon-refresh",size:"mini"},on:{click:e.resetQuery}},[e._v("重置")])],1)],1),a("el-row",{staticClass:"mb8",attrs:{gutter:10}},[a("el-col",{attrs:{span:1.5}},[e.adminOrCommon?a("el-button",{attrs:{type:"primary",plain:"",icon:"el-icon-plus",size:"mini"},on:{click:e.handleAdd}},[e._v(" 新增")]):e._e()],1),a("right-toolbar",{attrs:{showSearch:e.showSearch},on:{"update:showSearch":function(t){e.showSearch=t},"update:show-search":function(t){e.showSearch=t},queryTable:e.getList}})],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.projectList,"row-key":"id","default-expand-all":e.isExpandAll}},[a("el-table-column",{attrs:{fixed:"left",label:"序号",type:"index",align:"center",width:"50"}}),a("el-table-column",{attrs:{fixed:"left",prop:"code",width:"150",align:"center",label:"项目代码","show-overflow-tooltip":!0}}),a("el-table-column",{attrs:{fixed:"left",prop:"name",width:"100",align:"center",label:"项目名称","show-overflow-tooltip":!0}}),a("el-table-column",{attrs:{width:"250",label:"项目地点",align:"center","show-overflow-tooltip":!0},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.provinceName+"/"+t.row.cityName+"/"+t.row.areaName))])]}}])}),a("el-table-column",{attrs:{prop:"category",width:"300",align:"center",label:"服务类别","show-overflow-tooltip":!0},scopedSlots:e._u([{key:"default",fn:function(t){return[a("dict-tag",{attrs:{options:e.dict.type.project_category,value:t.row.category}})]}}])}),a("el-table-column",{attrs:{label:"状态",width:"150",align:"center",prop:"status"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("dict-tag",{attrs:{options:e.dict.type.project_status,value:t.row.status}})]}}])}),a("el-table-column",{attrs:{prop:"entrustDept",width:"150",align:"center",label:"委托单位","show-overflow-tooltip":!0}}),a("el-table-column",{attrs:{prop:"buildDept",width:"150",align:"center",label:"建设单位","show-overflow-tooltip":!0}}),a("el-table-column",{attrs:{prop:"evaluateDept",width:"150",align:"center",label:"被评审单位","show-overflow-tooltip":!0}}),a("el-table-column",{attrs:{prop:"projectType",width:"150",align:"center",label:"工程类型","show-overflow-tooltip":!0},scopedSlots:e._u([{key:"default",fn:function(t){return[a("dict-tag",{attrs:{options:e.dict.type.project_type,value:t.row.projectType}})]}}])}),a("el-table-column",{attrs:{prop:"investment",width:"150",align:"center",label:"投资额","show-overflow-tooltip":!0}}),a("el-table-column",{attrs:{prop:"description",width:"200",align:"center",label:"项目建设内容、规模描述","show-overflow-tooltip":!0}}),a("el-table-column",{attrs:{prop:"acceptanceFileName",width:"150",align:"center",label:"中标通知书","show-overflow-tooltip":!0}}),a("el-table-column",{attrs:{prop:"contractFileName",width:"150",align:"center",label:"委托函/合同附件","show-overflow-tooltip":!0}}),a("el-table-column",{attrs:{prop:"contraceDate",width:"180",align:"center",label:"合同签订时间","show-overflow-tooltip":!0}}),a("el-table-column",{attrs:{prop:"serviceStartTime",width:"180",align:"center",label:"服务开始时间","show-overflow-tooltip":!0}}),a("el-table-column",{attrs:{prop:"serviceEndTime",width:"180",align:"center",label:"服务结束时间","show-overflow-tooltip":!0}}),a("el-table-column",{attrs:{prop:"remark",width:"200",align:"center",label:"审批意见","show-overflow-tooltip":!0}}),a("el-table-column",{attrs:{prop:"createBy",width:"150",align:"center",label:"发起人","show-overflow-tooltip":!0}}),a("el-table-column",{attrs:{label:"创建时间",width:"150",align:"center",prop:"createTime"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e.parseTime(t.row.createTime)))])]}}])}),a("el-table-column",{attrs:{prop:"updateBy",width:"150",align:"center",label:"修改人","show-overflow-tooltip":!0}}),a("el-table-column",{attrs:{label:"修改时间",width:"150",align:"center",prop:"updateTime"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e.parseTime(t.row.createTime)))])]}}])}),a("el-table-column",{attrs:{fixed:"right",label:"操作",width:"250",align:"center","class-name":"small-padding fixed-width"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini",type:"text",icon:"el-icon-edit"},on:{click:function(a){return e.handleDetails(t.row)}}},[e._v("详情 ")]),"1"==t.row.status?a("el-button",{attrs:{size:"mini",type:"text",icon:"el-icon-edit"},on:{click:function(a){return e.handleStop(t.row)}}},[e._v("暂停")]):e._e(),"2"==t.row.status?a("el-button",{attrs:{size:"mini",type:"text",icon:"el-icon-edit"},on:{click:function(a){return e.handleStart(t.row)}}},[e._v("启动")]):e._e(),e.adminOrManager&&5==t.row.status?a("el-button",{attrs:{size:"mini",type:"text",icon:"el-icon-edit"},on:{click:function(a){return e.handleCheck(t.row)}}},[e._v("审批")]):e._e(),e.adminOrCommon&&t.row.isUpdate?a("el-button",{attrs:{size:"mini",type:"text",icon:"el-icon-edit"},on:{click:function(a){return e.handleUpdate(t.row)}}},[e._v("修改")]):e._e(),!e.adminOrManager||"0"!=t.row.status&&"5"!=t.row.status?e._e():a("el-button",{attrs:{size:"mini",type:"text",icon:"el-icon-delete"},on:{click:function(a){return e.handleDelete(t.row)}}},[e._v("删除")])]}}])})],1),a("pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total > 0"}],attrs:{total:e.total,page:e.queryParams.pageNum,limit:e.queryParams.pageSize},on:{"update:page":function(t){return e.$set(e.queryParams,"pageNum",t)},"update:limit":function(t){return e.$set(e.queryParams,"pageSize",t)},pagination:e.getList}})],1)},r=[],n=(a("b0c0"),a("d3b7"),a("159b"),a("bf97")),l=a("aa3a"),i=(a("caad"),a("2532"),a("4360"));function c(e){if(e&&e instanceof Array&&e.length>0){var t=i["a"].getters&&i["a"].getters.roles,a=e,o="admin",r=t.some((function(e){return o===e||a.includes(e)}));return!!r}return console.error("need roles! Like checkRole=\"['admin','editor']\""),!1}var s={name:"ProjectManage",dicts:["sys_show_hide","sys_normal_disable","project_status","project_category","project_type"],data:function(){return{status:[{value:"已建立"},{value:"资料搜集中"},{value:"意见搜集中"},{value:"报告编辑"},{value:"已完结"}],loading:!0,showSearch:!0,categoryOptions:[],queryParams:{pageNum:1,pageSize:10,code:void 0,name:void 0,category:void 0,status:void 0,createBy:void 0},adminOrManager:!1,adminOrCommon:!1,total:0,projectList:[],title:"",open:!1,isExpandAll:!1}},created:function(){this.getList(),this.checkRole(),this.getCategoryOptions()},methods:{getList:function(){var e=this;this.loading=!0,Object(n["j"])(this.addDateRange(this.queryParams,this.dateRange)).then((function(t){var a=t.rows,o=e.$store.state.user.name;a.forEach((function(e){"admin"==o||0==e.status&&e.createBy==o||0!=e.status&&5!=e.status?e.isUpdate=!0:e.isUpdate=!1})),e.projectList=a,e.total=t.total,e.loading=!1}))},checkRole:function(){this.adminOrManager=c(["manager"]),this.adminOrCommon=c(["common"])},cancel:function(){this.open=!1,this.reset()},getCategoryOptions:function(){var e=this;Object(l["d"])("project_category").then((function(t){var a=t.data,o={label:"评估类",value:"1",children:[]},r={label:"编制类",value:"2",children:[]};a.forEach((function(e){0==e.dictValue.indexOf("1")?o.children.push({label:e.dictLabel,value:e.dictValue}):0==e.dictValue.indexOf("2")&&r.children.push({label:e.dictLabel,value:e.dictValue})})),e.categoryOptions.push(o),e.categoryOptions.push(r)}))},reset:function(){this.queryParams={pageNum:1,pageSize:10,code:void 0,name:void 0,category:void 0,status:void 0,createBy:void 0},this.resetForm("form")},handleQuery:function(){this.getList()},resetQuery:function(){this.resetForm("queryForm"),this.handleQuery()},handleStop:function(e){var t=this;this.$modal.confirm('是否确认暂停名称为"'+e.name+'"的项目？').then((function(){return Object(n["o"])(e.id,"2")})).then((function(){t.getList(),t.$modal.msgSuccess("暂停成功")})).catch((function(){}))},handleStart:function(e){var t=this;this.$modal.confirm('是否确认启动名称为"'+e.name+'"的项目？').then((function(){return Object(n["o"])(e.id,"1")})).then((function(){t.getList(),t.$modal.msgSuccess("暂停成功")})).catch((function(){}))},handleAdd:function(e){this.$router.push("/projectManager/projectManagerForm")},handleUpdate:function(e){this.$router.push({path:"/projectManager/projectManagerForm",query:{id:e.id}})},handleCheck:function(e){this.$router.push({path:"/projectManager/check",query:{id:e.id}})},handleDetails:function(e){this.$router.push({path:"/projectManager/details",query:{id:e.id}})},submitForm:function(){var e=this;this.$refs["form"].validate((function(t){t&&(void 0!=e.form.id?Object(n["n"])(e.form).then((function(t){e.$modal.msgSuccess("修改成功"),e.open=!1,e.getList()})):Object(n["b"])(e.form).then((function(t){e.$modal.msgSuccess("新增成功"),e.open=!1,e.getList()})))}))},handleDelete:function(e){var t=this;this.$modal.confirm('是否确认删除名称为"'+e.name+'"的项目？').then((function(){return Object(n["e"])(e.id)})).then((function(){t.getList(),t.$modal.msgSuccess("删除成功")})).catch((function(){}))}}},u=s,d=a("2877"),p=Object(d["a"])(u,o,r,!1,null,null,null);t["default"]=p.exports},bf97:function(e,t,a){"use strict";a.d(t,"j",(function(){return r})),a.d(t,"k",(function(){return n})),a.d(t,"g",(function(){return l})),a.d(t,"i",(function(){return i})),a.d(t,"b",(function(){return c})),a.d(t,"n",(function(){return s})),a.d(t,"c",(function(){return u})),a.d(t,"e",(function(){return d})),a.d(t,"o",(function(){return p})),a.d(t,"l",(function(){return m}));var o=a("b775");function r(e){return Object(o["a"])({url:"/project/pageList",method:"get",params:e})}function n(){return Object(o["a"])({url:"/project/listRunning",method:"get"})}function l(e){return Object(o["a"])({url:"/project/getById/"+e,method:"get"})}function i(e){return Object(o["a"])({url:"/project/queryByName?query="+e,method:"get"})}function c(e){return Object(o["a"])({url:"/project/add",method:"post",data:e})}function s(e){return Object(o["a"])({url:"/project/update",method:"put",data:e})}function u(e){return Object(o["a"])({url:"/project/check",method:"post",data:e})}function d(e){return Object(o["a"])({url:"/project/deleteById?id="+e,method:"delete"})}function p(e,t){return Object(o["a"])({url:"/project/updateStatus/"+e+"/"+t,method:"get"})}function m(e){return Object(o["a"])({url:"/project/selectUserByProjectId/"+e,method:"get"})}}}]);