(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-05ea9464"],{"15ab":function(e,t,a){"use strict";a.d(t,"c",(function(){return o})),a.d(t,"a",(function(){return r})),a.d(t,"b",(function(){return i}));var l=a("b775");function o(e){return Object(l["a"])({url:"/material/pageList",method:"get",params:e})}function r(e){return Object(l["a"])({url:"/material/add",method:"post",data:e})}function i(e){return Object(l["a"])({url:"/material/download",method:"post",data:e,responseType:"blob"})}},"42f5":function(e,t,a){"use strict";a.d(t,"b",(function(){return o})),a.d(t,"a",(function(){return r}));var l=a("b775");function o(e){return Object(l["a"])({url:"/template/queryByName?query="+e,method:"get"})}function r(e,t){return Object(l["a"])({url:"/template/getMailText?id="+e,method:"post",data:t})}},a369:function(e,t,a){"use strict";a.r(t);var l=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container"},[a("el-form",{ref:"queryForm",attrs:{model:e.queryParams,size:"small",inline:!0}},[a("el-form-item",{attrs:{label:"所属项目",prop:"selectedProject"}},[a("el-select",{attrs:{"value-key":"name",placeholder:"搜索并选择所属项目",filterable:"",remote:"","remote-method":e.queryProjects,loading:e.projectQueryLoading},on:{change:e.selectedProjectChanged},model:{value:e.selectedProject,callback:function(t){e.selectedProject=t},expression:"selectedProject"}},e._l(e.projects,(function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e}})})),1)],1)],1),e.projectSelectedFlag?a("el-row",{staticClass:"mb8",attrs:{gutter:10}},[a("el-col",{attrs:{span:1.5}},[a("el-button",{attrs:{type:"primary",plain:"",icon:"el-icon-plus",size:"mini"},on:{click:e.handleAddMail}},[e._v("新增收资函")]),a("el-button",{attrs:{type:"primary",plain:"",icon:"el-icon-circle-plus-outline",size:"mini"},on:{click:e.handleAddMaterial}},[e._v("代上传")]),a("el-button",{attrs:{type:"success",plain:"",icon:"el-icon-download",size:"mini"},on:{click:e.handleDownload}},[e._v("打包下载")]),a("el-button",{attrs:{type:"primary",plain:"",icon:"el-icon-refresh",size:"mini"},on:{click:e.getList}},[e._v("刷新")]),a("el-button",{attrs:{type:"success",plain:"",icon:"el-icon-check",size:"mini"},on:{click:e.finishMaterialsCollect}},[e._v("收资完成")])],1)],1):e._e(),e.projectSelectedFlag?a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.materialList,"row-key":"id"},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"50",align:"center"}}),a("el-table-column",{attrs:{prop:"name",label:"名称","show-overflow-tooltip":!0}}),a("el-table-column",{attrs:{prop:"project.editDept",label:"编制单位","show-overflow-tooltip":!0}}),a("el-table-column",{attrs:{prop:"createBy",label:"提交人","show-overflow-tooltip":!0}}),a("el-table-column",{attrs:{prop:"project.name",label:"所属项目","show-overflow-tooltip":!0}}),a("el-table-column",{attrs:{prop:"status",label:"文件附件","show-overflow-tooltip":!0}}),a("el-table-column",{attrs:{label:"创建时间",align:"center",prop:"createTime"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e.parseTime(t.row.createTime)))])]}}],null,!1,3078210614)}),a("el-table-column",{attrs:{label:"操作",align:"center","class-name":"small-padding fixed-width"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["system:menu:edit"],expression:"['system:menu:edit']"}],attrs:{size:"mini",type:"text",icon:"el-icon-edit"},on:{click:function(a){return e.handleUpdate(t.row)}}},[e._v("修改")]),a("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["system:menu:remove"],expression:"['system:menu:remove']"}],attrs:{size:"mini",type:"text",icon:"el-icon-delete"},on:{click:function(a){return e.handleDelete(t.row)}}},[e._v("删除")])]}}],null,!1,1229956554)})],1):e._e(),e.projectSelectedFlag?a("pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total>0"}],attrs:{total:e.total,page:e.queryParams.pageNum,limit:e.queryParams.pageSize},on:{"update:page":function(t){return e.$set(e.queryParams,"pageNum",t)},"update:limit":function(t){return e.$set(e.queryParams,"pageSize",t)},pagination:e.getList}}):e._e(),a("el-dialog",{attrs:{title:"新建收资函",visible:e.open,width:"680px","append-to-body":""},on:{"update:visible":function(t){e.open=t}}},[a("el-form",{ref:"mailInfoForm",attrs:{model:e.mailInfoForm,"label-width":"100px",rules:e.mailInfoRules}},[a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"关联模板",prop:"template"}},[a("el-select",{attrs:{"value-key":"name",placeholder:"",clearable:"",filterable:"",remote:"","remote-method":e.queryMailTemplates,loading:e.materialQueryLoading},model:{value:e.mailInfoForm.template,callback:function(t){e.$set(e.mailInfoForm,"template",t)},expression:"mailInfoForm.template"}},e._l(e.templates,(function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"项目名称",prop:"projectName"}},[a("el-input",{attrs:{disabled:!0},model:{value:e.mailInfoForm.projectName,callback:function(t){e.$set(e.mailInfoForm,"projectName",t)},expression:"mailInfoForm.projectName"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"编制单位",prop:"editDept"}},[a("el-input",{attrs:{disabled:!0},model:{value:e.mailInfoForm.editDept,callback:function(t){e.$set(e.mailInfoForm,"editDept",t)},expression:"mailInfoForm.editDept"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"收件人",prop:"receiver"}},[a("el-input",{attrs:{placeholder:"请输入收件人"},model:{value:e.mailInfoForm.receiver,callback:function(t){e.$set(e.mailInfoForm,"receiver",t)},expression:"mailInfoForm.receiver"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"发件人",prop:"sender"}},[a("el-input",{attrs:{placeholder:"请输入发件人"},model:{value:e.mailInfoForm.sender,callback:function(t){e.$set(e.mailInfoForm,"sender",t)},expression:"mailInfoForm.sender"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"联系方式",prop:"contact"}},[a("el-input",{attrs:{placeholder:"请输入联系方式"},model:{value:e.mailInfoForm.contact,callback:function(t){e.$set(e.mailInfoForm,"contact",t)},expression:"mailInfoForm.contact"}})],1)],1),a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:"说明",prop:"description"}},[a("el-input",{attrs:{type:"textarea",rows:4,placeholder:"请输入说明"},model:{value:e.mailInfoForm.description,callback:function(t){e.$set(e.mailInfoForm,"description",t)},expression:"mailInfoForm.description"}})],1)],1)],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:e.submitMailInfoForm}},[e._v("生成函件")]),a("el-button",{on:{click:e.cancel}},[e._v("取 消")])],1)],1),a("el-dialog",{attrs:{title:"收资函文本",visible:e.mailTextDialogOpen,width:"680px"},on:{"update:visible":function(t){e.mailTextDialogOpen=t}}},[a("el-input",{attrs:{type:"textarea",rows:10},model:{value:e.materialCollectText,callback:function(t){e.materialCollectText=t},expression:"materialCollectText"}}),a("span",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{directives:[{name:"clipboard",rawName:"v-clipboard:copy",value:e.materialCollectText,expression:"materialCollectText",arg:"copy"},{name:"clipboard",rawName:"v-clipboard:success",value:e.copyMailTextSuccess,expression:"copyMailTextSuccess",arg:"success"},{name:"clipboard",rawName:"v-clipboard:error",value:e.copyMailTextFailed,expression:"copyMailTextFailed",arg:"error"}],attrs:{type:"primary"}},[e._v(" 复制 ")]),a("el-button",{on:{click:e.cancel}},[e._v("取消")])],1)],1),a("el-dialog",{attrs:{title:"代上传资料",visible:e.uploadMaterialVisible,width:"680px"},on:{"update:visible":function(t){e.uploadMaterialVisible=t}}},[a("el-form",{ref:"uploadMaterialForm",attrs:{model:e.uploadMaterialFormModel,"label-width":"100px",rules:e.uploadMaterialRules}},[a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"资源名称",prop:"name"}},[a("el-input",{model:{value:e.uploadMaterialFormModel.name,callback:function(t){e.$set(e.uploadMaterialFormModel,"name",t)},expression:"uploadMaterialFormModel.name"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"项目名称",prop:"projectName"}},[a("el-input",{attrs:{disabled:!0},model:{value:e.uploadMaterialFormModel.projectName,callback:function(t){e.$set(e.uploadMaterialFormModel,"projectName",t)},expression:"uploadMaterialFormModel.projectName"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"编制单位",prop:"editDept"}},[a("el-input",{attrs:{disabled:!0},model:{value:e.uploadMaterialFormModel.editDept,callback:function(t){e.$set(e.uploadMaterialFormModel,"editDept",t)},expression:"uploadMaterialFormModel.editDept"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"文件上传"}},[a("el-upload",{ref:"upload",attrs:{limit:1,action:e.upload.url,"file-list":e.upload.fileList,headers:e.upload.headers,"on-success":e.handleFileSuccess,"auto-upload":!1}},[a("el-button",{attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[e._v("选取文件")])],1)],1)],1)],1)],1),a("span",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:e.handleUploadMaterial}},[e._v("确定")]),a("el-button",{on:{click:e.cancel}},[e._v("取 消")])],1)],1)],1)},o=[],r=(a("b0c0"),a("d81d"),a("d3b7"),a("3ca3"),a("ddb0"),a("2b3d"),a("9861"),a("bf97")),i=a("15ab"),n=a("42f5"),s=a("5f87"),c={name:"MaterialCollect",data:function(){return{projectSelectedFlag:!1,materialCollectText:"",projects:[],projectQueryLoading:!1,materialQueryLoading:!1,selectMaterials:[],total:0,selectedProject:void 0,queryParams:{pageNum:1,pageSize:10,projectId:void 0},mailInfoForm:{},loading:!1,materialList:[],open:!1,mailTextDialogOpen:!1,uploadMaterialVisible:!1,templates:[],upload:{headers:{Authorization:"Bearer "+Object(s["a"])()},url:"/prod-api/common/upload",fileList:[]},uploadMaterialFormModel:{},mailInfoRules:{template:[{required:!0,message:"关联模板不能为空",trigger:"blur"}],receiver:[{required:!0,message:"收件人不能为空",trigger:"blur"}],sender:[{required:!0,message:"发件人不能为空",trigger:"blur"}],contact:[{required:!0,message:"联系方式不能为空",trigger:"blur"}],description:[{required:!0,message:"说明不能为空",trigger:"blur"}]},uploadMaterialRules:{name:[{required:!0,message:"资料名称不能为空",trigger:"blur"}]}}},created:function(){this.queryProjects("")},methods:{queryProjects:function(e){var t=this;this.projectQueryLoading=!0,Object(r["i"])(e).then((function(e){t.projects=e.projects,t.projectQueryLoading=!1}))},getList:function(){var e=this;this.loading=!0,this.queryParams.projectId=this.selectedProject.id,Object(i["c"])(this.addDateRange(this.queryParams,this.dateRange)).then((function(t){e.materialList=t.rows,e.total=t.total,e.loading=!1,e.selectMaterials=[]}))},handleSelectionChange:function(e){this.selectMaterials=e},cancel:function(){this.open=!1,this.mailTextDialogOpen=!1,this.uploadMaterialVisible=!1,this.resetAddMailForm(),this.resetUploadMaterialForm()},resetAddMailForm:function(){this.mailInfoForm={template:void 0,projectName:this.selectedProject.name,editDept:this.selectedProject.editDept,receiver:void 0,sender:void 0,contact:void 0,description:void 0},this.materialCollectText="",this.resetForm("mailInfoForm")},selectedProjectChanged:function(e){this.projectSelectedFlag=!0,this.selectedProject=e,this.getList()},finishMaterialsCollect:function(){this.resetForm("queryForm"),this.handleQuery()},handleAddMail:function(e){this.resetAddMailForm(),this.queryMailTemplates(""),this.open=!0},queryMailTemplates:function(e){var t=this;this.materialQueryLoading=!0,Object(n["b"])(e).then((function(e){t.templates=e.templates,t.materialQueryLoading=!1}))},handleAddMaterial:function(){this.resetUploadMaterialForm(),this.uploadMaterialVisible=!0},resetUploadMaterialForm:function(){this.uploadMaterialFormModel={name:void 0,projectName:this.selectedProject.name,editDept:this.selectedProject.editDept},this.upload.fileList=[]},handleUploadMaterial:function(){var e=this;this.$refs["uploadMaterialForm"].validate((function(t){t&&e.$refs.upload.submit()}))},handleFileSuccess:function(e,t,a){var l=this,o={name:this.uploadMaterialFormModel.name,status:"已上传",projectId:this.selectedProject.id,distPath:e.url};Object(i["a"])(o).then((function(e){l.$modal.msgSuccess("保存成功"),l.uploadMaterialVisible=!1,l.getList()}))},handleDownload:function(){var e=this,t=this.selectMaterials.map((function(e){return e.id})),a="".concat(this.selectedProject.name,"-资料.zip");Object(i["b"])(t).then((function(t){e.$modal.msgSuccess("下载成功");var l=t,o=new Blob([l]);if("download"in document.createElement("a")){var r=document.createElement("a");r.download=a,r.style.display="none",r.href=URL.createObjectURL(o),document.body.appendChild(r),r.click(),URL.revokeObjectURL(r.href),document.body.removeChild(r)}else navigator.msSaveBlob(o,a)}))},handleUpdate:function(e){},submitMailInfoForm:function(){var e=this;this.$refs["mailInfoForm"].validate((function(t){t&&Object(n["a"])(e.mailInfoForm.template,e.mailInfoForm).then((function(t){e.materialCollectText=t.text,e.open=!1,e.mailTextDialogOpen=!0}))}))},copyMailTextSuccess:function(){this.$modal.msgSuccess("复制成功")},copyMailTextFailed:function(){this.$modal.msgError("复制失败")},handleDelete:function(e){var t=this;this.$modal.confirm('是否确认删除名称为"'+e.menuName+'"的数据项？').then((function(){return delMenu(e.menuId)})).then((function(){t.getList(),t.$modal.msgSuccess("删除成功")})).catch((function(){}))}}},u=c,d=a("2877"),m=Object(d["a"])(u,l,o,!1,null,null,null);t["default"]=m.exports},bf97:function(e,t,a){"use strict";a.d(t,"j",(function(){return o})),a.d(t,"k",(function(){return r})),a.d(t,"g",(function(){return i})),a.d(t,"i",(function(){return n})),a.d(t,"b",(function(){return s})),a.d(t,"n",(function(){return c})),a.d(t,"c",(function(){return u})),a.d(t,"e",(function(){return d})),a.d(t,"o",(function(){return m})),a.d(t,"l",(function(){return p}));var l=a("b775");function o(e){return Object(l["a"])({url:"/project/pageList",method:"get",params:e})}function r(){return Object(l["a"])({url:"/project/listRunning",method:"get"})}function i(e){return Object(l["a"])({url:"/project/getById/"+e,method:"get"})}function n(e){return Object(l["a"])({url:"/project/queryByName?query="+e,method:"get"})}function s(e){return Object(l["a"])({url:"/project/add",method:"post",data:e})}function c(e){return Object(l["a"])({url:"/project/update",method:"put",data:e})}function u(e){return Object(l["a"])({url:"/project/check",method:"post",data:e})}function d(e){return Object(l["a"])({url:"/project/deleteById?id="+e,method:"delete"})}function m(e,t){return Object(l["a"])({url:"/project/updateStatus/"+e+"/"+t,method:"get"})}function p(e){return Object(l["a"])({url:"/project/selectUserByProjectId/"+e,method:"get"})}}}]);